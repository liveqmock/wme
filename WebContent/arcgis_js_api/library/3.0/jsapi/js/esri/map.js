/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/main,esri/_coremap,esri/touchcontainer,dijit/form/HorizontalSlider,dijit/form/VerticalSlider,dijit/form/HorizontalRule,dijit/form/VerticalRule,dijit/form/HorizontalRuleLabels,dijit/form/VerticalRuleLabels,esri/layers/agsdynamic,esri/layers/agstiled,esri/layers/agsimageservice"],function(_1,_2,_3){_2.provide("esri.map");_2.require("esri.main");_2.require("esri._coremap");if(esri.isTouchEnabled){_2.require("esri.touchcontainer");}else{_2.declare("esri._MapContainer",esri._CoreMap,(function(){var dc=_2.connect,_4=_2.disconnect,dh=_2.hitch,_5=_2.mixin,_6=_2.isMozilla,_7=_2.stopEvent,_8=_2.fixEvent,_9=esri.geometry.Point;var _a=navigator.userAgent.indexOf("Macintosh")!==-1?1:3,_b=_2.isChrome<2?360:120,_c=1,_d=1,_e=300;return {constructor:function(_f){_5(this,{_dragEnd:false,_clickDuration:_e,_downCoords:null,_clickTimer:null,_onKeyDown_connect:null,_onKeyUp_connect:null,_onMouseDragHandler_connect:null});var _10=this.__container,_11=this._connects;_11.push(dc(_10,"onselectstart",function(evt){_7(evt);return false;}),dc(_10,"ondragstart",function(evt){_7(evt);return false;}));if(_6){_2.style(_10,"MozUserSelect","none");}_11.push(dc(_10,"onmouseenter",this,"_onMouseEnterHandler"),dc(_10,"onmouseleave",this,"_onMouseLeaveHandler"),dc(_10,"onmousedown",this,"_onMouseDownHandler"),dc(_10,"onclick",this,"_onClickHandler"),dc(_10,"ondblclick",this,"_onDblClickHandler"));this.enableMouseWheel(false);this._onMouseMoveHandler_connect=dc(_10,"onmousemove",this,"_onMouseMoveHandler");this._onMouseUpHandler_connect=dc(_10,"onmouseup",this,"_onMouseUpHandler");this._processEvent=dh(this,this._processEvent);this._fireClickEvent=dh(this,this._fireClickEvent);},_cleanUp:function(){_4(this._onMouseMoveHandler_connect);_4(this._onMouseUpHandler_connect);_4(this._onMouseDragHandler_connect);_4(this._scrollHandle);var _12=this._connects,i;for(i=_12.length;i>=0;i--){_4(_12[i]);delete _12[i];}this.inherited("_cleanUp",arguments);},_processEvent:function(evt){evt=_8(evt,evt.target);if(evt.type==="DOMMouseScroll"&&_2.isFF<3){evt.screenPoint=new _9(window.scrollX+evt.screenX-this.position.x,window.scrollY+evt.screenY-this.position.y);}else{evt.screenPoint=new _9(evt.pageX-this.position.x,evt.pageY-this.position.y);}evt.mapPoint=this.extent?this.toMap(evt.screenPoint):new _9();return evt;},_onMouseEnterHandler:function(evt){_4(this._onKeyDown_connect);_4(this._onKeyUp_connect);this._onKeyDown_connect=dc(document,"onkeydown",this,"_onKeyDownHandler");this._onKeyUp_connect=dc(document,"onkeyup",this,"_onKeyUpHandler");this.onMouseOver(this._processEvent(evt));},_onMouseLeaveHandler:function(evt){_4(this._onKeyDown_connect);_4(this._onKeyUp_connect);this.onMouseOut(this._processEvent(evt));},_onMouseMoveHandler:function(evt){if(this._dragEnd){this._dragEnd=false;return;}this.onMouseMove(this._processEvent(evt));},_onMouseDownHandler:function(evt){_4(this._onMouseMoveHandler_connect);var _13=this.__container;if(_13.setCapture){_13.setCapture(false);}this._onMouseDragHandler_connect=dc(document,"onmousemove",this,"_onMouseDragHandler");evt=this._processEvent(evt);this._downCoords=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);},_onMouseUpHandler:function(evt){var _14=this.__container;if(_14.releaseCapture){_14.releaseCapture();}evt=this._processEvent(evt);_4(this._onMouseDragHandler_connect);_4(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=dc(_14,"onmousemove",this,"_onMouseMoveHandler");this.onMouseUp(evt);},_onMouseDragHandler:function(evt){_4(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=dc(document,"onmousemove",this,"_onMouseDraggingHandler");_4(this._onMouseUpHandler_connect);this._onMouseUpHandler_connect=dc(document,"onmouseup",this,"_onDragMouseUpHandler");this._docLeaveConnect=dc(document,"onmouseout",this,"_onDocMouseOut");this.onMouseDragStart(this._processEvent(evt));},_onDocMouseOut:function(evt){var _15=evt.relatedTarget,_16=evt.relatedTarget&&evt.relatedTarget.nodeName.toLowerCase();if(!_15||(_2.isChrome&&_16==="html")){this._onDragMouseUpHandler(evt);}},_onMouseDraggingHandler:function(evt){this.onMouseDrag(this._processEvent(evt));_2.stopEvent(evt);},_onDragMouseUpHandler:function(evt){var _17=this.__container;if(_17.releaseCapture){_17.releaseCapture();}this._dragEnd=true;evt=this._processEvent(evt);this.onMouseDragEnd(evt);_4(this._docLeaveConnect);_4(this._onMouseDragHandler_connect);_4(this._onMouseUpHandler_connect);this._onMouseMoveHandler_connect=dc(_17,"onmousemove",this,"_onMouseMoveHandler");this._onMouseUpHandler_connect=dc(_17,"onmouseup",this,"_onMouseUpHandler");this.onMouseUp(evt);},_onClickHandler:function(evt){evt=this._processEvent(evt);if(this._downCoords!==(evt.screenPoint.x+","+evt.screenPoint.y)){return;}clearTimeout(this._clickTimer);this._clickEvent=_5({},evt);this._clickTimer=setTimeout(this._fireClickEvent,this._clickDuration);},_fireClickEvent:function(){clearTimeout(this._clickTimer);if(_2.isIE<9){var GL=esri.layers.GraphicsLayer;this._clickEvent.graphic=GL._clicked;delete GL._clicked;}this.onClick(this._clickEvent);},_onDblClickHandler:function(evt){clearTimeout(this._clickTimer);this.onDblClick(this._processEvent(evt));},_onMouseWheelHandler:function(evt){if(this.__canStopSWEvt()){_2.stopEvent(evt);}evt=this._processEvent(evt);var _18=_2.isIE||_2.isWebKit?evt.wheelDelta/_b:-evt.detail/_a,_19=Math.abs(_18);if(_19<=_c){_19=_c;}else{_19=_d;}evt.value=_18<0?-_19:_19;this.onMouseWheel(evt);},__canStopSWEvt:function(){},_onKeyDownHandler:function(evt){this.onKeyDown(evt);},_onKeyUpHandler:function(evt){this.onKeyUp(evt);},__setClickDuration:function(dur){this._clickDuration=dur;},__resetClickDuration:function(){this._clickDuration=_e;},enableMouseWheel:function(_1a){_4(this._scrollHandle);this._scrollHandle=dc(this.__container,(_2.isFF||_6)?(_1a?"MozMousePixelScroll":"DOMMouseScroll"):"onmousewheel",this,this._onMouseWheelHandler);},onMouseOver:function(){},onMouseMove:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseDragStart:function(){},onMouseDrag:function(){},onMouseDragEnd:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},onMouseWheel:function(){},onKeyDown:function(){},onKeyUp:function(){}};}()));}_2.require("dijit.form.HorizontalSlider");_2.require("dijit.form.VerticalSlider");_2.require("dijit.form.HorizontalRule");_2.require("dijit.form.VerticalRule");_2.require("dijit.form.HorizontalRuleLabels");_2.require("dijit.form.VerticalRuleLabels");_2.declare("esri.Map",esri._MapContainer,(function(){var _1b=30,_1c=100,_1d=30,_1e=10,_1f=1,_20=-1,_21=_2.mouseButtons.LEFT,_22={up:"panUp",right:"panRight",down:"panDown",left:"panLeft"},_23={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"};var dc=_2.connect,ddc=_2.disconnect,dcr=_2.create,ds=_2.style,dh=_2.hitch,abs=Math.abs,_24=_2.coords,_25=_2.deprecated,dk=_2.keys,_26=_2.mixin,_27=esri.geometry.Rect,_28=esri.geometry.Point,_29=esri.geometry.Extent;var _2a=[dk.NUMPAD_PLUS,61,dk.NUMPAD_MINUS,dk.UP_ARROW,dk.NUMPAD_8,dk.RIGHT_ARROW,dk.NUMPAD_6,dk.DOWN_ARROW,dk.NUMPAD_2,dk.LEFT_ARROW,dk.NUMPAD_4,dk.PAGE_UP,dk.NUMPAD_9,dk.PAGE_DOWN,dk.NUMPAD_3,dk.END,dk.NUMPAD_1,dk.HOME,dk.NUMPAD_7];return {constructor:function(_2b,_2c){_26(this,{_dragOrigin:null,_slider:null,_navDiv:null,_zoomRect:null,_mapParams:_26({slider:true,nav:false,logo:true,sliderStyle:"default"},_2c||{}),_zoom:0,_keyboardPanDx:0,_keyboardPanDy:0});_26(this,{_onLoadHandler_connect:null,_panHandler_connect:null,_panStartHandler_connect:null,_upPanHandler_connect:null,_dblClickZoomHandler_connect:null,_recenterZoomHandler_connect:null,_recenterHandler_connect:null,_downPanHandler_connect:null,_downZoomHandler_connect:null,_keyNavigatingHandler_connect:null,_keyNavigationEndHandler_connect:null,_scrollZoomHandler_connect:null,_zoomHandler_connect:null,_upZoomHandler_connect:null});_26(this,{isDoubleClickZoom:false,isShiftDoubleClickZoom:false,isClickRecenter:false,isScrollWheelZoom:false,isPan:false,isRubberBandZoom:false,isKeyboardNavigation:false,isPanArrows:false,isZoomSlider:false});if(_2.isFunction(esri._css)){esri._css=esri._css(this._mapParams.force3DTransforms);this.force3DTransforms=this._mapParams.force3DTransforms;}var _2d=(esri._hasTransforms&&esri._hasTransitions);this.navigationMode=this._mapParams.navigationMode||(_2d&&"css-transforms")||"classic";if(this.navigationMode==="css-transforms"&&!_2d){this.navigationMode="classic";}this.fadeOnZoom=esri._isDefined(this._mapParams.fadeOnZoom)?this._mapParams.fadeOnZoom:(this.navigationMode==="css-transforms");if(this.navigationMode!=="css-transforms"){this.fadeOnZoom=false;}this._zoomRect=new esri.Graphic(null,new esri.symbol.SimpleFillSymbol(esri.config.defaults.map.zoomSymbol));this.setMapCursor("default");this.smartNavigation=_2c&&_2c.smartNavigation;if(!esri._isDefined(this.smartNavigation)&&_2.isMac&&!esri.isTouchEnabled&&!(_2.isFF<=3.5)){var _2e=navigator.userAgent.match(/Mac\s+OS\s+X\s+([\d]+)(\.|\_)([\d]+)\D/i);if(_2e&&esri._isDefined(_2e[1])&&esri._isDefined(_2e[3])){var _2f=parseInt(_2e[1],10),_30=parseInt(_2e[3],10);this.smartNavigation=((_2f>10)||(_2f===10&&_30>=6));}}this._onLoadHandler_connect=dc(this,"onLoad",this,"_onLoadInitNavsHandler");if(this._mapParams.logo){var _31={right:(this._mapParams.nav?"25px":"")};if(_2.isIE===6){_31.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+_2.moduleUrl("esri")+"../../images/map/logo-med.png"+"')";}var _32=this._ogol=dcr("div",{style:_31},this.root);if((this.root.clientWidth*this.root.clientHeight)<250000){_2.addClass(_32,"logo-sm");}else{_2.addClass(_32,"logo-med");}if(!esri.isTouchEnabled){this._ogol_connect=dc(_32,"onclick",this,"_openLogoLink");}}if(esri.isTouchEnabled){this._panInitEvent="onTouchStart";this._zoomInitEvent="onGestureStart";}else{this._panInitEvent="onMouseDown";this._zoomInitEvent="onMouseDown";}},_cleanUp:function(){this.disableMapNavigation();var i;for(i=this._connects.length;i>=0;i--){ddc(this._connects[i]);delete this._connects[i];}ddc(this._slider_connect);ddc(this._ogol_connect);var _33=this._slider;if(_33&&_33.destroy&&!_33._destroyed){_33.destroy();}var _34=this._navDiv;if(_34){_2.destroy(_34);}this.inherited("_cleanUp",arguments);},_normalizeRect:function(evt){var xy=evt.screenPoint,dx=this._dragOrigin.x,dy=this._dragOrigin.y,_35=new _27((xy.x<dx?xy.x:dx)-this.__visibleRect.x,(xy.y<dy?xy.y:dy)-this.__visibleRect.y,abs(xy.x-dx),abs(xy.y-dy));if(_35.width===0){_35.width=1;}if(_35.height===0){_35.height=1;}return _35;},_downZoomHandler:function(evt){if(evt.button===_21&&evt.shiftKey&&this.isRubberBandZoom){this._dragOrigin=_26({},evt.screenPoint);this.setCursor("crosshair");this._zoomHandler_connect=dc(this,"onMouseDrag",this,"_zoomHandler");this._upZoomHandler_connect=dc(this,"onMouseUp",this,"_upZoomHandler");if(evt.ctrlKey){this._zoom=_20;}else{this._zoom=_1f;}if(_2.isChrome){evt.preventDefault();}}},_zoomHandler:function(evt){var _36=this._normalizeRect(evt).offset(this.__visibleRect.x,this.__visibleRect.y),g=this.graphics,_37=this._zoomRect;if(!_37.geometry){this.setCursor("crosshair");}if(_37.geometry){g.remove(_37,true);}var tl=this.toMap(new _28(_36.x,_36.y)),br=this.toMap(new _28(_36.x+_36.width,_36.y+_36.height));_36=new _27(tl.x,tl.y,br.x-tl.x,tl.y-br.y);_36._originOnly=true;_37.setGeometry(_36);g.add(_37,true);},_upZoomHandler:function(evt){var _38=this._zoomRect;ddc(this._zoomHandler_connect);ddc(this._upZoomHandler_connect);if(this._canZoom(this._zoom)&&_38.getDojoShape()){this.graphics.remove(_38);_38.geometry=null;var _39=this._normalizeRect(evt);_39.x+=this.__visibleRect.x;_39.y+=this.__visibleRect.y;var _3a;if(this._zoom===_20){var _3b=this.extent.getWidth(),_3c=(_3b*this.width)/_39.width,_3d=(_3c-_3b)/2,ext=this.extent;_3a=new _29(ext.xmin-_3d,ext.ymin-_3d,ext.xmax+_3d,ext.ymax+_3d,this.spatialReference);}else{var min=this.toMap({x:_39.x,y:(_39.y+_39.height)}),max=this.toMap({x:(_39.x+_39.width),y:_39.y});_3a=new _29(min.x,min.y,max.x,max.y,this.spatialReference);}this._extentUtil(null,null,_3a);}if(_38.getDojoShape()){this.graphics.remove(_38,true);}this._zoom=0;this.resetMapCursor();},_downPanHandler:function(evt){if(evt.button===_21&&!evt.shiftKey&&this.isPan){this._dragOrigin=new _28(0,0);_26(this._dragOrigin,evt.screenPoint);this._panHandler_connect=dc(this,"onMouseDrag",this,"_panHandler");this._panStartHandler_connect=dc(this,"onMouseDragStart",this,"_panStartHandler");this._upPanHandler_connect=dc(this,"onMouseUp",this,"_upPanHandler");if(_2.isChrome){evt.preventDefault();}}},_panStartHandler:function(evt){this.setCursor("move");this.__panStart(evt.screenPoint.x,evt.screenPoint.y);},_panHandler:function(evt){this.__pan(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);},_upPanHandler:function(evt){ddc(this._panHandler_connect);ddc(this._panStartHandler_connect);ddc(this._upPanHandler_connect);if(this.__panning){this.__panEnd(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);this.resetMapCursor();}},_isPanningOrZooming:function(){return this.__panning||this.__zooming;},_recenterHandler:function(evt){if(evt.shiftKey&&!this._isPanningOrZooming()){this.centerAt(evt.mapPoint);}},_recenterZoomHandler:function(evt){if(evt.shiftKey&&!this._isPanningOrZooming()){evt.value=evt.ctrlKey?-1:1;this._scrollZoomHandler(evt,true);}},_dblClickZoomHandler:function(evt){if(!this._isPanningOrZooming()){evt.value=1;this._scrollZoomHandler(evt,true);}},_canZoom:function(_3e){if(!this.__tileInfo){return true;}var _3f=this.getLevel(),_40=this.getNumLevels();if((_3f===0&&_3e<0)||(_3f===_40-1&&_3e>0)){return false;}return true;},_scrollZoomHandler:function(evt,_41){if(!_41){if(this.smartNavigation&&!evt.shiftKey&&!this._isPanningOrZooming()){this.disableScrollWheelZoom();this._setScrollWheelPan(true);this._scrollPanHandler(evt);return;}var _42=evt.timeStamp;if(!esri._isDefined(_42)||_42<=0){_42=(new Date()).getTime();}var _43=this._ts?(_42-this._ts):_42;if(_43<_1c){return;}this._ts=_42;}if(!this._canZoom(evt.value)){return;}this._extentUtil({numLevels:evt.value,mapAnchor:evt.mapPoint,screenAnchor:evt.screenPoint});},_scrollPanHandler:function(evt){if(evt.shiftKey&&!this._isPanningOrZooming()){this._setScrollWheelPan(false);this.enableScrollWheelZoom();this._scrollZoomHandler(evt);return;}var dx=0,dy=0;if(_2.isFF){if(evt.axis===evt.HORIZONTAL_AXIS){dx=-evt.detail;}else{dy=-evt.detail;}}else{dx=evt.wheelDeltaX;dy=evt.wheelDeltaY;}this.translate(dx,dy);},_keyNavigatingHandler:function(evt){var kc=evt.keyCode;if(_2.indexOf(_2a,kc)!==-1){if(kc===dk.NUMPAD_PLUS||kc===61){this._extentUtil({numLevels:1});}else{if(kc===dk.NUMPAD_MINUS){this._extentUtil({numLevels:-1});}else{if(!this.__panning){this.__panStart(0,0);}switch(kc){case dk.UP_ARROW:case dk.NUMPAD_8:this._keyboardPanDy+=_1e;break;case dk.RIGHT_ARROW:case dk.NUMPAD_6:this._keyboardPanDx-=_1e;break;case dk.DOWN_ARROW:case dk.NUMPAD_2:this._keyboardPanDy-=_1e;break;case dk.LEFT_ARROW:case dk.NUMPAD_4:this._keyboardPanDx+=_1e;break;case dk.PAGE_UP:case dk.NUMPAD_9:this._keyboardPanDx-=_1e;this._keyboardPanDy+=_1e;break;case dk.PAGE_DOWN:case dk.NUMPAD_3:this._keyboardPanDx-=_1e;this._keyboardPanDy-=_1e;break;case dk.END:case dk.NUMPAD_1:this._keyboardPanDx+=_1e;this._keyboardPanDy-=_1e;break;case dk.HOME:case dk.NUMPAD_7:this._keyboardPanDx+=_1e;this._keyboardPanDy+=_1e;break;default:return;}this.__pan(this._keyboardPanDx,this._keyboardPanDy);}}_2.stopEvent(evt);}},_keyNavigationEndHandler:function(evt){if(this.__panning&&(evt.keyCode!==dk.SHIFT)){this.__panEnd(this._keyboardPanDx,this._keyboardPanDy);this._keyboardPanDx=this._keyboardPanDy=0;}},_onLoadInitNavsHandler:function(){this.enableMapNavigation();this._createNav();if(this._mapParams.sliderStyle==="small"||!this._createSlider){this._createSimpleSlider();}else{this._createSlider();}ddc(this._onLoadHandler_connect);},_createNav:function(){if(this._mapParams.nav){var div,v,i,_44=_2.addClass,id=this.id;this._navDiv=dcr("div",{id:id+"_navdiv"},this.root);_44(this._navDiv,"navDiv");var w2=this.width/2,h2=this.height/2,wh;for(i in _22){v=_22[i];div=dcr("div",{id:id+"_pan_"+i},this._navDiv);_44(div,"fixedPan "+v);if(i==="up"||i==="down"){wh=parseInt(_24(div).w,10)/2;ds(div,{left:(w2-wh)+"px",zIndex:_1b});}else{wh=parseInt(_24(div).h,10)/2;ds(div,{top:(h2-wh)+"px",zIndex:_1b});}this._connects.push(dc(div,"onclick",dh(this,this[v])));}this._onMapResizeNavHandler_connect=dc(this,"onResize",this,"_onMapResizeNavHandler");for(i in _23){v=_23[i];div=dcr("div",{id:id+"_pan_"+i,style:{zIndex:_1b}},this._navDiv);_44(div,"fixedPan "+v);this._connects.push(dc(div,"onclick",dh(this,this[v])));}this.isPanArrows=true;}},_onMapResizeNavHandler:function(_45,wd,ht){var id=this.id,w2=wd/2,h2=ht/2,_46=_2.byId,i,div,wh;for(i in _22){div=_46(id+"_pan_"+i);if(i==="up"||i==="down"){wh=parseInt(_24(div).w,10)/2;ds(div,"left",(w2-wh)+"px");}else{wh=parseInt(_24(div).h,10)/2;ds(div,"top",(h2-wh)+"px");}}},_createSimpleSlider:function(){if(this._mapParams.slider){var _47=(this._slider=dcr("div",{id:this.id+"_zoom_slider","class":"esriSimpleSlider",style:"z-index: "+_1d+";"}));_2.addClass(_47,esri.config.defaults.map.slider.width?"esriSimpleSliderHorizontal":"esriSimpleSliderVertical");var _48=dcr("div",{"class":"esriSimpleSliderIncrementButton"},_47);_48.innerHTML="+";var _49=dcr("div",{"class":"esriSimpleSliderDecrementButton"},_47);_49.innerHTML="-";if(_2.isIE<8){_2.addClass(_49,"dj_ie67Fix");}this._connects.push(dc(_48,"onclick",this,this._simpleSliderChangeHandler));this._connects.push(dc(_49,"onclick",this,this._simpleSliderChangeHandler));this.root.appendChild(_47);this.isZoomSlider=true;}},_simpleSliderChangeHandler:function(evt){var _4a=(evt.currentTarget.className.indexOf("IncrementButton")!==-1)?true:false;this._extentUtil({numLevels:_4a?1:-1});},_createSlider:function(){if(this._mapParams.slider){var div=dcr("div",{id:this.id+"_zoom_slider"},this.root),_4b=esri.config.defaults.map,_4c=_4b.slider.width,_4d=_4c?_1.form.HorizontalSlider:_1.form.VerticalSlider,_4e=_2.toJson(_26({position:"absolute"},_4b.slider)),_4f=this.getNumLevels(),_50=_1.form,i,il,_51;_4e=_4e.substring(1,_4e.length-1).split("\"").join("").split(",").join(";");if(_4f>0){var _52,_53,_54,_55,_56,_57=_4b.sliderLabel;if(_57){var _58=_4c?_50.HorizontalRule:_50.VerticalRule,_59=_4c?_50.HorizontalRuleLabels:_50.VerticalRuleLabels,_5a=_4c?"topDecoration":"rightDecoration",_5b=_4c?"height:"+_57.tick+"px":"width:"+_57.tick+"px";_56=_57.labels;if(_56===null){_56=[];for(i=0,il=_4f;i<il;i++){_56[i]="";}}_52=dcr("div");div.appendChild(_52);_53=new _58({container:_5a,count:_4f,style:_5b},_52);_54=dcr("div");div.appendChild(_54);_55=new _59({container:_5a,count:_4f,labels:_56,style:_57.style},_54);_52=_54=null;}_51=(this._slider=new _4d({id:div.id,minimum:0,maximum:_4f-1,discreteValues:_4f,value:this.getLevel(),clickSelect:true,intermediateChanges:true,style:_4e+"; z-index:"+_1d+";"},div));_51.startup();if(_57){_53.startup();_55.startup();}this._slider_connect=dc(_51,"onChange",this,"_onSliderChangeHandler");this._connects.push(dc(this,"onExtentChange",this,"_onExtentChangeSliderHandler"));this._connects.push(dc(_51._movable,"onFirstMove",this,"_onSliderMoveStartHandler"));}else{_51=(this._slider=new _4d({id:div.id,minimum:0,maximum:2,discreteValues:3,value:1,clickSelect:true,intermediateChanges:_4b.sliderChangeImmediate,style:_4e+" height:100px; z-index:"+_1d+";"},div));var _5c=_51.domNode.firstChild.childNodes;for(i=1;i<=3;i++){ds(_5c[i],"visibility","hidden");}_51.startup();this._slider_connect=dc(_51,"onChange",this,"_onDynSliderChangeHandler");this._connects.push(dc(this,"onExtentChange",this,"_onExtentChangeDynSliderHandler"));}var _5d=_51.incrementButton,_5e=_51.decrementButton;_5d.style.outline="none";_5e.style.outline="none";_51.sliderHandle.style.outline="none";_51._onKeyPress=function(){};var _5f=_51._movable;if(_5f){var _60=_5f.onMouseDown;_5f.onMouseDown=function(e){if(_2.isIE<9&&e.button!==1){return;}_60.apply(this,arguments);};}this.isZoomSlider=true;}},_onSliderMoveStartHandler:function(){ddc(this._slider_connect);ddc(this._slidermovestop_connect);this._slider_connect=dc(this._slider,"onChange",this,"_onSliderChangeDragHandler");this._slidermovestop_connect=dc(this._slider._movable,"onMoveStop",this,"_onSliderMoveEndHandler");},_onSliderChangeDragHandler:function(_61){this._extentUtil({targetLevel:_61});},_onSliderMoveEndHandler:function(){ddc(this._slider_connect);ddc(this._slidermovestop_connect);},_onSliderChangeHandler:function(_62){this.setLevel(_62);},_updateSliderValue:function(_63,_64){ddc(this._slider_connect);var _65=this._slider;var _66=_65._onChangeActive;_65._onChangeActive=false;_65.set("value",_63);_65._onChangeActive=_66;this._slider_connect=dc(_65,"onChange",this,_64);},_onExtentChangeSliderHandler:function(_67,_68,_69,lod){ddc(this._slidermovestop_connect);this._updateSliderValue(lod.level,"_onSliderChangeHandler");},_onDynSliderChangeHandler:function(_6a){this._extentUtil({numLevels:_6a>0?1:-1});},_onExtentChangeDynSliderHandler:function(){this._updateSliderValue(1,"_onDynSliderChangeHandler");},_openLogoLink:function(evt){window.open(esri.config.defaults.map.logoLink,"_blank");_2.stopEvent(evt);},enableMapNavigation:function(){this.enableDoubleClickZoom();this.enableClickRecenter();this.enablePan();this.enableRubberBandZoom();this.enableKeyboardNavigation();if(this.smartNavigation){this._setScrollWheelPan(true);}else{this.enableScrollWheelZoom();}},disableMapNavigation:function(){this.disableDoubleClickZoom();this.disableClickRecenter();this.disablePan();this.disableRubberBandZoom();this.disableKeyboardNavigation();this.disableScrollWheelZoom();if(this.smartNavigation){this._setScrollWheelPan(false);}},enableDoubleClickZoom:function(){if(!this.isDoubleClickZoom){this._dblClickZoomHandler_connect=dc(this,"onDblClick",this,"_dblClickZoomHandler");this.isDoubleClickZoom=true;}},disableDoubleClickZoom:function(){if(this.isDoubleClickZoom){ddc(this._dblClickZoomHandler_connect);this.isDoubleClickZoom=false;}},enableShiftDoubleClickZoom:function(){if(!this.isShiftDoubleClickZoom){_25(this.declaredClass+": "+esri.bundle.map.deprecateShiftDblClickZoom,null,"v2.0");this._recenterZoomHandler_connect=dc(this,"onDblClick",this,"_recenterZoomHandler");this.isShiftDoubleClickZoom=true;}},disableShiftDoubleClickZoom:function(){if(this.isShiftDoubleClickZoom){_25(this.declaredClass+": "+esri.bundle.map.deprecateShiftDblClickZoom,null,"v2.0");ddc(this._recenterZoomHandler_connect);this.isShiftDoubleClickZoom=false;}},enableClickRecenter:function(){if(!this.isClickRecenter){this._recenterHandler_connect=dc(this,"onClick",this,"_recenterHandler");this.isClickRecenter=true;}},disableClickRecenter:function(){if(this.isClickRecenter){ddc(this._recenterHandler_connect);this.isClickRecenter=false;}},enablePan:function(){if(!this.isPan){this._downPanHandler_connect=dc(this,this._panInitEvent,this,"_downPanHandler");this.isPan=true;}},disablePan:function(){if(this.isPan){ddc(this._downPanHandler_connect);this.isPan=false;}},enableRubberBandZoom:function(){if(!this.isRubberBandZoom){this._downZoomHandler_connect=dc(this,this._zoomInitEvent,this,"_downZoomHandler");this.isRubberBandZoom=true;}},disableRubberBandZoom:function(){if(this.isRubberBandZoom){ddc(this._downZoomHandler_connect);this.isRubberBandZoom=false;}},enableKeyboardNavigation:function(){if(!this.isKeyboardNavigation){this._keyNavigatingHandler_connect=dc(this,"onKeyDown",this,"_keyNavigatingHandler");this._keyNavigationEndHandler_connect=dc(this,"onKeyUp",this,"_keyNavigationEndHandler");this.isKeyboardNavigation=true;}},disableKeyboardNavigation:function(){if(this.isKeyboardNavigation){ddc(this._keyNavigatingHandler_connect);ddc(this._keyNavigationEndHandler_connect);this.isKeyboardNavigation=false;}},enableScrollWheelZoom:function(){if(!this.isScrollWheelZoom){this._scrollZoomHandler_connect=dc(this,"onMouseWheel",this,"_scrollZoomHandler");this.isScrollWheelZoom=true;}},__canStopSWEvt:function(){return this.isScrollWheelZoom||this.isScrollWheelPan;},disableScrollWheelZoom:function(){if(this.isScrollWheelZoom){ddc(this._scrollZoomHandler_connect);this.isScrollWheelZoom=false;}},_setScrollWheelPan:function(_6b){this.isScrollWheelPan=_6b;this.enableMouseWheel(_6b);ddc(this._mwMacHandle);if(_6b){this._mwMacHandle=dc(this,"onMouseWheel",this,this._scrollPanHandler);}},showPanArrows:function(){if(this._navDiv){esri.show(this._navDiv);this.isPanArrows=true;}},hidePanArrows:function(){if(this._navDiv){esri.hide(this._navDiv);this.isPanArrows=false;}},showZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","visible");this.isZoomSlider=true;}},hideZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","hidden");this.isZoomSlider=false;}}};}()));_2.require("esri.layers.agsdynamic");_2.require("esri.layers.agstiled");_2.require("esri.layers.agsimageservice");if(esri.isTouchEnabled){_2.extend(esri.Map,(function(){var dc=_2.connect,ddc=_2.disconnect,_6c=esri.geometry.Point,_6d=esri.geometry.getLength,_6e=esri.TileUtils.getCandidateTileInfo;return {_multiTouchTapZoomHandler:function(evt){if(!this._isPanningOrZooming()){evt.value=-1;this._scrollZoomHandler(evt,true);}},_downPanHandler:function(evt){var _6f=this._zoomAnim||this._panAnim;if(_6f&&_6f._active){_6f.stop();_6f._fire("onEnd",[_6f.node]);}this._dragOrigin=new _6c(0,0);_2.mixin(this._dragOrigin,evt.screenPoint);ddc(this._panHandler_connect);ddc(this._upPanHandler_connect);this._panHandler_connect=dc(this,"onTouchMove",this,this._panHandler);this._upPanHandler_connect=dc(this,"onTouchEnd",this,this._upPanHandler);},_panHandler:function(evt){evt.preventDefault();if(this.__panning){this._panX=evt.screenPoint.x;this._panY=evt.screenPoint.y;this.__pan(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);}else{this.setCursor("move");this.__panStart(evt.screenPoint.x,evt.screenPoint.y);}},_upPanHandler:function(evt){ddc(this._panHandler_connect);ddc(this._upPanHandler_connect);if(this.__panning){this.__panEnd(evt.screenPoint.x-this._dragOrigin.x,evt.screenPoint.y-this._dragOrigin.y);this.resetMapCursor();}},_downZoomHandler:function(evt){var _70=this._zoomAnim||this._panAnim;if(_70&&_70._active){_70.stop();_70._fire("onEnd",[_70.node]);}else{if(this.__panning){evt.screenPoint=new _6c(this._panX,this._panY);evt.mapPoint=this.toMap(evt.screenPoint);this._upPanHandler(evt);}}ddc(this._zoomHandler_connect);ddc(this._upZoomHandler_connect);this._zoomHandler_connect=dc(this,"onGestureChange",this,this._zoomHandler);this._upZoomHandler_connect=dc(this,"onGestureEnd",this,this._upZoomHandler);},_zoomHandler:function(evt){if(evt.screenPoints){evt.preventDefault();this.currLength=_6d(evt.screenPoints[0],evt.screenPoints[1]);if(this.__zooming){var _71=this.currLength/this._length;this._zoomStartExtent=this.__scaleExtent(this.extent,_71,this._dragOrigin);this.__zoom(this._zoomStartExtent,_71,this._dragOrigin);}else{this._dragOrigin=new _6c((evt.screenPoints[0].x+evt.screenPoints[1].x)/2,(evt.screenPoints[0].y+evt.screenPoints[1].y)/2);this._length=this.currLength;this.__zoomStart(this.extent,this._dragOrigin);}this._fireOnScale(this.currLength/this._length,this._dragOrigin,true);}},_upZoomHandler:function(evt){ddc(this._zoomHandler_connect);ddc(this._upZoomHandler_connect);if(evt.processMultiTouchTap){this._multiTouchTapZoomHandler(evt);evt.preventDefault();}else{if(this.__zooming&&this._zoomAnim===null){var _72=this.currLength/this._length,_73=this.extent.getWidth();this._zoomAnimAnchor=this.toMap(this._dragOrigin);this._zoomStartExtent=this.__scaleExtent(this.extent,1/_72,this._zoomAnimAnchor);if(this.__tileInfo){var ct=_6e(this,this.__tileInfo,this._zoomStartExtent),_74=this.__getExtentForLevel(ct.lod.level,this._zoomAnimAnchor),_75=this.getNumLevels()-1,_76=_74.extent,_77=_74.lod,_78=_73/_76.getWidth(),_79=ct.lod.level;if(_72<1){if(_78>_72){_79--;}}else{if(_78<_72){_79++;}}if(_79<0){_79=0;}else{if(_79>_75){_79=_75;}}if(_79!==ct.lod.level){_74=this.__getExtentForLevel(_79,this._zoomAnimAnchor);_76=_74.extent;_77=_74.lod;}this._zoomEndExtent=_76;this._zoomEndLod=_77;this._zoomAnim=esri.fx.animateRange({range:{start:(_73/this._zoomStartExtent.getWidth()),end:_78},duration:esri.config.defaults.map.zoomDuration,rate:esri.config.defaults.map.zoomRate,onAnimate:_2.hitch(this,"_adjustZoomHandler"),onEnd:_2.hitch(this,"_adjustZoomEndHandler")}).play();this._fireOnScale(this.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin);}else{this._zoomEndExtent=this._zoomStartExtent;this._fireOnScale(this.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin);this._adjustZoomEndHandler();}}}},_adjustZoomHandler:function(_7a){var _7b=this.__scaleExtent(this.extent,_7a,this._zoomAnimAnchor);this.__zoom(_7b,_7a,this._dragOrigin);},_adjustZoomEndHandler:function(){var _7c=this.extent.getWidth()/this._zoomEndExtent.getWidth(),_7d=this.__scaleExtent(this.extent,1/_7c,this._zoomAnimAnchor);this.__zoomEnd(_7d,_7c,this._dragOrigin,this._zoomEndLod,true);this._zoomStartExtent=this._zoomEndExtent=this._zoomEndLod=this._dragOrigin=this._zoomAnim=this._zoomAnimAnchor=null;}};}()));}});